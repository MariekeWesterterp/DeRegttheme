{% set header_classes = "dr-header" %}
{% if module.appearance.bottom_background == "transparent" %}
  {% set header_classes = header_classes ~ " dr-header--transparent dr-header--overlay" %}
{% else %}
  {% set header_classes = header_classes ~ " dr-header--white" %}
{% endif %}
{% if module.appearance.add_shadow %}
  {% set header_classes = header_classes ~ " dr-header--shadow" %}
{% endif %}

{% set logo_settings = module.branding.logo %}
{% set has_logo = (logo_settings.override_inherited_src and logo_settings.src) or (not logo_settings.override_inherited_src and brand_settings.logo.src) or (not logo_settings.suppress_company_name) %}
{% set instance_id = module.module_instance_id or module.module_id %}

{% if module.anchor %}
  <a id="{{ module.anchor|escape_attr }}" class="dr-header__anchor" data-hs-anchor="true"></a>
{% endif %}

<header class="{{ header_classes }}" data-module-instance="{{ instance_id }}" role="banner">
  {% if module.top_bar.show and (module.top_bar.tagline or module.top_bar.menu) %}
    {% set top_menu = None %}
    {% if module.top_bar.menu %}
      {% set top_menu = menu(module.top_bar.menu, "site_root") %}
    {% endif %}
    <div class="dr-header__top">
      <div class="container">
        <div class="dr-header__top-inner">
          <div class="dr-header__tagline-wrap">
            {% if module.top_bar.tagline %}
              <span class="dr-header__tagline">{{ module.top_bar.tagline }}</span>
            {% endif %}
          </div>
          {% if top_menu and top_menu.children %}
            <nav class="dr-header__top-nav" aria-label="Secondary navigation">
              <ul class="dr-header__top-list">
                {% for item in top_menu.children %}
                  <li class="dr-header__top-item">
                    <a class="dr-header__top-link {{ "is-active" if item.activeNode }}" href="{{ item.url }}" {{ "aria-current=\"page\"" if item.activeNode }}>{{ item.label }}</a>
                  </li>
                {% endfor %}
              </ul>
            </nav>
          {% endif %}
        </div>
      </div>
    </div>
  {% endif %}

  <div class="dr-header__bottom">
    <div class="container">
      <div class="dr-header__bottom-inner">
        <div class="dr-header__brand">
          <button class="dr-header__toggle" type="button" aria-expanded="false" aria-controls="dr-header-nav-{{ instance_id }}">
            <span class="show-for-sr">Toggle navigation</span>
            <span class="dr-header__toggle-lines"></span>
          </button>

          {% if has_logo %}
            {% set logo_src = logo_settings.src if logo_settings.override_inherited_src else brand_settings.logo.src %}
            {% set logo_alt = logo_settings.alt if logo_settings.override_inherited_src else brand_settings.logo.alt %}
            {% set logo_width = logo_settings.width if logo_settings.override_inherited_src else brand_settings.logo.width %}
            {% set logo_height = logo_settings.height if logo_settings.override_inherited_src else brand_settings.logo.height %}
            {% set logo_loading = logo_settings.loading if logo_settings.loading else 'eager' %}
            {% set logo_link = module.branding.link %}
            {% set logo_href = logo_link.href if logo_link.href else '/' %}
            {% set logo_target = logo_link.target if logo_link.target else ('_blank' if logo_link.open_in_new_tab else '_self') %}
            {% set logo_rel = 'noopener' if logo_target == '_blank' else None %}
            <a class="dr-header__logo" href="{{ logo_href|escape_url }}" target="{{ logo_target }}" {% if logo_rel %}rel="{{ logo_rel }}"{% endif %}>
              <img src="{{ logo_src|escape_url }}" alt="{{ logo_alt|default(site_settings.company_name)|escape_attr }}" width="{{ logo_width }}" height="{{ logo_height }}" loading="{{ logo_loading }}">
            </a>
          {% else %}
            <span class="dr-header__logo dr-header__logo--text">{{ site_settings.company_name }}</span>
          {% endif %}
        </div>

        {% set primary_menu = menu(module.primary_navigation.menu, "site_root") %}
        {% if primary_menu.children %}
          <nav class="dr-header__nav" id="dr-header-nav-{{ instance_id }}" aria-label="Primary navigation">
            <ul class="dr-header__nav-list">
              {% for item in primary_menu.children %}
                <li class="dr-header__nav-item">
                  <a class="dr-header__nav-link {{ "is-active" if item.activeNode }}" href="{{ item.url }}" {{ "aria-current=\"page\"" if item.activeNode }}>{{ item.label }}</a>
                </li>
              {% endfor %}
            </ul>
          </nav>
        {% endif %}

        {% if module.cta_button.show and module.cta_button.text and module.cta_button.url.href %}
          {% set cta_target = module.cta_button.url.target || ('_blank' if module.cta_button.url.open_in_new_tab else '_self') %}
          {% set cta_rel = 'noopener' if cta_target == '_blank' else None %}
          <a class="dr-header__cta" href="{{ module.cta_button.url.href|escape_url }}" target="{{ cta_target }}" {% if cta_rel %}rel="{{ cta_rel }}"{% endif %}>{{ module.cta_button.text }}</a>
        {% endif %}
      </div>
    </div>
  </div>
</header>
